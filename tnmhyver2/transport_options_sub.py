# -*- coding: utf-8 -*-
"""transport_options12.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1kkzoqBlegD0CLrWcP6T3IxBVdnobfOsf
"""

import streamlit as st
import pandas as pd

# ä¼šå ´ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ
files = {
    "å¤§é˜ªâ‘ ï¼ˆ2025/07/19-20ï¼‰": {
        "å¾€è·¯1: æ±äº¬â†’æ–°å¤§é˜ª": r"C:\äº¤é€šè²»\æ–°å¹¹ç·šã€€å¤§é˜ª\tokyo_shinosaka_20250719_real_full.csv",
        "å¾€è·¯2: æ–°å¤§é˜ªâ†’å¤§é˜ª": r"C:\äº¤é€šè²»\æ–°å¹¹ç·šã€€å¤§é˜ª\osaka_shinosaka0719 - ã‚³ãƒ”ãƒ¼.csv",
        "å¾©è·¯1: å¤§é˜ªâ†’æ–°å¤§é˜ª": r"C:\äº¤é€šè²»\æ–°å¹¹ç·šã€€å¤§é˜ª\shinosaka_osaka0720-ã‚³ãƒ”ãƒ¼.csv",
        "å¾©è·¯2: æ–°å¤§é˜ªâ†’æ±äº¬": r"C:\äº¤é€šè²»\æ–°å¹¹ç·šã€€å¤§é˜ª\shinosaka_tokyo_20250720_timetable_fare.csv",
    },
    "å¤§é˜ªâ‘¡ï¼ˆ2025/07/26-27ï¼‰": {
        "å¾€è·¯1: æ±äº¬â†’æ–°å¤§é˜ª": r"C:\äº¤é€šè²»\æ–°å¹¹ç·šã€€å¤§é˜ª\tokyo_shinosaka_20250726_real_full.csv",
        "å¾€è·¯2: æ–°å¤§é˜ªâ†’å¤§é˜ª": r"C:\äº¤é€šè²»\æ–°å¹¹ç·šã€€å¤§é˜ª\osaka_shinosaka0726 - ã‚³ãƒ”ãƒ¼.csv",
        "å¾©è·¯1: å¤§é˜ªâ†’æ–°å¤§é˜ª": r"C:\äº¤é€šè²»\æ–°å¹¹ç·šã€€å¤§é˜ª\shinosaka_osaka0727-ã‚³ãƒ”ãƒ¼.csv",
        "å¾©è·¯2: æ–°å¤§é˜ªâ†’æ±äº¬": r"C:\äº¤é€šè²»\æ–°å¹¹ç·šã€€å¤§é˜ª\shinosaka_tokyo_20250727_timetable_fare.csv",
    },
    "å²é˜œï¼ˆ2025/08/02-03ï¼‰": {
        "å¾€è·¯1: æ±äº¬â†’åå¤å±‹": r"C:\äº¤é€šè²»\æ–°å¹¹ç·šã€€åå¤å±‹\tokyo_nozomi_nagoya_fare.csv",
        "å¾€è·¯2: åå¤å±‹â†’åœŸå²å¸‚": r"C:\äº¤é€šè²»\æ–°å¹¹ç·šã€€åå¤å±‹\nagoya_tokishi_chuo_20250802.csv",
        "å¾©è·¯1: åœŸå²å¸‚â†’åå¤å±‹": r"C:\äº¤é€šè²»\æ–°å¹¹ç·šã€€åå¤å±‹\tokishi_nagoya_custom_textpattern.csv",
        "å¾©è·¯2: åå¤å±‹â†’æ±äº¬": r"C:\äº¤é€šè²»\æ–°å¹¹ç·šã€€åå¤å±‹\nagoya_tokyo_nozomi_20250803.csv",
    },
    "ç¦å²¡ï¼ˆ2025/08/16-17ï¼‰": {
        "å¾€è·¯1: æˆç”°ç©ºæ¸¯â†’ç¦å²¡ç©ºæ¸¯": r"C:\äº¤é€šè²»\hukuoka\20250816naritahukuoka.csv",
        "å¾€è·¯2: ç¦å²¡ç©ºæ¸¯â†’åšå¤š": r"C:\äº¤é€šè²»\hukuoka\fukuoka_airport_to_hakata_timetable.csv",
        "å¾€è·¯3: åšå¤šâ†’ä¹…ç•™ç±³": r"C:\äº¤é€šè²»\hukuoka\hakata_to_kurume.csv",
        "å¾©è·¯1: ä¹…ç•™ç±³â†’åšå¤š": r"C:\äº¤é€šè²»\hukuoka\kurume_to_hakata.csv",
        "å¾©è·¯2: åšå¤šâ†’ç¦å²¡ç©ºæ¸¯": r"C:\äº¤é€šè²»\hukuoka\hakata_to_fukuoka_airport_timetable.csv",
        "å¾©è·¯3: ç¦å²¡ç©ºæ¸¯â†’æˆç”°ç©ºæ¸¯": r"C:\äº¤é€šè²»\hukuoka\20250817hukuokanarita.csv",
    },
}

def load_segmented_transport_data(venue_name):
    return files.get(venue_name, {})

def load_and_format_segment_file(path):
    try:
        if path.endswith(".csv"):
          try:
                df = pd.read_csv(path, encoding="utf-8")  # é€šå¸¸èª­ã¿è¾¼ã¿
          except UnicodeDecodeError:
                df = pd.read_csv(path, encoding="shift_jis")  # Excelä¿å­˜å¯¾å¿œ

        else:
          df = pd.read_excel(path)
    except Exception as e:
        print(f"èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: {e}")
        return pd.DataFrame()

    for col in ["ç™ºæ™‚åˆ»", "ç€æ™‚åˆ»", "æ‰€è¦æ™‚é–“", "è·¯ç·š", "è¡Œå…ˆ", "æ–™é‡‘"]:
        if col not in df.columns:
            df[col] = ""
    df["æ–™é‡‘"] = pd.to_numeric(df["æ–™é‡‘"], errors="coerce").fillna(0).astype(int)
    return df

# ==== Streamlit UI ====
st.title("ä¼šå ´åˆ¥ ä¹—æ›ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼")

ä¼šå ´ = st.sidebar.selectbox("ä¼šå ´ã‚’é¸æŠ", list(files.keys()))
selected_rows = []
åˆè¨ˆé‡‘é¡ = 0

for åŒºé–“å, ãƒ•ã‚¡ã‚¤ãƒ« in load_segmented_transport_data(ä¼šå ´).items():
    st.subheader(f"ã€{åŒºé–“å}ã€‘")
    df = load_and_format_segment_file(ãƒ•ã‚¡ã‚¤ãƒ«)
    if df.empty:
        st.warning("èª­ã¿è¾¼ã¿å¤±æ•—ã¾ãŸã¯ãƒ‡ãƒ¼ã‚¿ãªã—")
        continue

    # æœ€å®‰ä¾¿ã‚’æŠ½å‡º
    idx_min = df["æ–™é‡‘"].idxmin()
    minrow = df.loc[idx_min]
    st.markdown(f"ğŸŸ¢ **æœ€å®‰ææ¡ˆ:** {minrow['ç™ºæ™‚åˆ»']}ç™º {minrow['è·¯ç·š']} â†’ {minrow['æ–™é‡‘']}å††")

    # ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠ
    options = df.apply(lambda row: " / ".join(row.values.astype(str)), axis=1)
    user_sel = st.selectbox(f"{åŒºé–“å} ä¾¿ã‚’é¸æŠ", options, key=åŒºé–“å)
    sel_row = df.iloc[options.tolist().index(user_sel)]
    selected_rows.append(sel_row)
    åˆè¨ˆé‡‘é¡ += int(sel_row["æ–™é‡‘"])
    st.dataframe(df)

st.markdown(f"## ğŸš„ **é¸æŠåˆè¨ˆé‡‘é¡: {åˆè¨ˆé‡‘é¡:,}å††**")
st.write("### é¸æŠã—ãŸä¾¿ãƒªã‚¹ãƒˆ")
for row, åŒºé–“å in zip(selected_rows, files[ä¼šå ´].keys()):
    st.write(f"ã€{åŒºé–“å}ã€‘ {row.to_dict()}")